<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Premium Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-btn { 
            padding: 10px 20px; 
            margin: 10px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .test-btn:hover { background: #0056b3; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px; 
            background: #f8f9fa; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üß™ Teste das Corre√ß√µes Premium</h1>
    
    <div>
        <button class="test-btn" onclick="testPremiumManager()">Testar PremiumManager</button>
        <button class="test-btn" onclick="testGoogleUser()">Testar GetGoogleUser</button>
        <button class="test-btn" onclick="testStripeInit()">Testar Stripe Init</button>
    </div>
    
    <div id="results"></div>

    <!-- Scripts necess√°rios -->
    <script src="js/storage.js?v=1141"></script>
    <script src="js/auth.js?v=1141"></script>
    <script src="js/mock-api.js?v=1150"></script>
    <script src="js/premium.js?v=1150"></script>
    <script src="js/app.js?v=1149"></script>

    <script>
        let results = document.getElementById('results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
        }

        // Aguarda app carregar
        document.addEventListener('DOMContentLoaded', async () => {
            addResult('üìã DOM carregado, aguardando depend√™ncias...');
            
            // Aguarda depend√™ncias b√°sicas
            const wait = () => new Promise(r => {
                const check = () => {
                    if (window.mentalStorage) r();
                    else setTimeout(check, 100);
                };
                check();
            });
            
            try {
                await wait();
                addResult('‚úÖ Depend√™ncias b√°sicas carregadas');
                
                // Tenta inicializar MentalIA
                if (typeof MentalIA !== 'undefined') {
                    window.mentalIA = new MentalIA();
                    await window.mentalIA.init();
                    addResult('‚úÖ MentalIA inicializado', 'success');
                } else {
                    addResult('‚ö†Ô∏è MentalIA n√£o encontrado, testando apenas Premium', 'info');
                }
                
                // Testa PremiumManager independentemente
                if (window.premiumManager) {
                    addResult('‚úÖ PremiumManager j√° dispon√≠vel', 'success');
                } else {
                    addResult('‚ÑπÔ∏è PremiumManager ser√° criado automaticamente', 'info');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro na inicializa√ß√£o: ${error.message}`, 'error');
            }
        });

        async function testPremiumManager() {
            try {
                addResult('üß™ Testando PremiumManager...');
                
                if (!window.premiumManager) {
                    addResult('‚ùå PremiumManager n√£o encontrado', 'error');
                    return;
                }
                
                addResult('‚úÖ PremiumManager dispon√≠vel', 'success');
                
                // Testa se o m√©todo getGoogleUser existe
                if (typeof window.premiumManager.getGoogleUser === 'function') {
                    addResult('‚úÖ M√©todo getGoogleUser dispon√≠vel', 'success');
                } else {
                    addResult('‚ùå M√©todo getGoogleUser n√£o encontrado', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        async function testGoogleUser() {
            try {
                addResult('üß™ Testando getGoogleUser...');
                
                if (!window.premiumManager) {
                    addResult('‚ùå PremiumManager n√£o dispon√≠vel', 'error');
                    return;
                }
                
                const user = await window.premiumManager.getGoogleUser();
                if (user) {
                    addResult(`‚úÖ Usu√°rio obtido: ${user.email}`, 'success');
                } else {
                    addResult('‚ÑπÔ∏è Usu√°rio n√£o logado (normal)', 'info');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro ao obter usu√°rio: ${error.message}`, 'error');
            }
        }

        async function testStripeInit() {
            try {
                addResult('üß™ Testando inicializa√ß√£o Stripe...');
                
                if (!window.premiumManager) {
                    addResult('‚ùå PremiumManager n√£o dispon√≠vel', 'error');
                    return;
                }
                
                if (window.premiumManager.stripe) {
                    addResult('‚úÖ Stripe inicializado', 'success');
                } else {
                    addResult('‚ùå Stripe n√£o inicializado', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro no teste Stripe: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>