<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentalIA - Debug Storage</title>
</head>
<body>
    <h1>Debug do Storage MentalIA</h1>
    <button onclick="debugStorage()">Verificar Storage</button>
    <div id="result"></div>

    <script src="js/storage.js"></script>
    <script>
        async function debugStorage() {
            try {
                console.log('üîç Iniciando debug do storage...');

                if (!window.mentalStorage) {
                    throw new Error('Storage n√£o dispon√≠vel');
                }

                // Verificar inicializa√ß√£o
                console.log('üîç Verificando inicializa√ß√£o do storage...');
                console.log('üîç Storage initialized:', window.mentalStorage.initialized);
                console.log('üîç Storage db:', !!window.mentalStorage.db);
                console.log('üîç Storage encryptionKey:', !!window.mentalStorage.encryptionKey);

                // For√ßar inicializa√ß√£o se necess√°rio
                if (!window.mentalStorage.initialized) {
                    console.log('üîÑ For√ßando inicializa√ß√£o...');
                    await window.mentalStorage.init();
                }

                // Obter entradas
                const entries = await window.mentalStorage.getAllMoodEntries();
                console.log('üìä Entradas encontradas:', entries.length);

                // Analisar formato das entradas
                const analysis = {
                    totalEntries: entries.length,
                    entries: entries.map((entry, index) => ({
                        index: index + 1,
                        id: entry.id,
                        mood: entry.mood,
                        moodType: typeof entry.mood,
                        timestamp: entry.timestamp,
                        feelings: entry.feelings,
                        diary: entry.diary ? entry.diary.substring(0, 50) + '...' : null
                    }))
                };

                console.log('üìä An√°lise das entradas:', analysis);

                // Exibir resultado
                document.getElementById('result').innerHTML = `
                    <h2>Status do Storage</h2>
                    <p><strong>Total de entradas:</strong> ${analysis.totalEntries}</p>

                    <h3>Entradas encontradas:</h3>
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; max-height: 400px; overflow-y: auto;">
                        <pre>${JSON.stringify(analysis.entries, null, 2)}</pre>
                    </div>

                    <h3>Valida√ß√£o:</h3>
                    <ul>
                        <li>Storage dispon√≠vel: ‚úÖ</li>
                        <li>Entradas encontradas: ${analysis.totalEntries > 0 ? '‚úÖ' : '‚ùå'}</li>
                        <li>Formato v√°lido: ${analysis.entries.every(e => typeof e.mood === 'number' || !isNaN(parseFloat(e.mood))) ? '‚úÖ' : '‚ùå'}</li>
                    </ul>
                `;

            } catch (error) {
                console.error('‚ùå Erro no debug:', error);
                document.getElementById('result').innerHTML = `
                    <p style="color: red;">Erro: ${error.message}</p>
                    <pre style="background: #ffe6e6; padding: 10px; border-radius: 5px;">${error.stack}</pre>
                `;
            }
        }
    </script>
</body>
</html>