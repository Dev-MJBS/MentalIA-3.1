<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentalIA 3.1 - Sa√∫de Mental com IA Local</title>
    
">
">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="App de sa√∫de mental com IA local e privacidade absoluta">
    <link rel="manifest" href="manifest.json">

    <!-- Icons (recommended sizes) -->
    <link rel="icon" type="image/png" sizes="48x48" href="icons/icon-48.png">
    <link rel="icon" type="image/png" sizes="72x72" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icons/icon-96.png">
    <link rel="icon" type="image/png" sizes="144x144" href="icons/icon-144.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">

    <!-- Apple / iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Android / Windows tile -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="msapplication-TileImage" content="icons/icon-192.png">
    
    <!-- Chart.js CDN - Vers√£o est√°vel -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Transformers.js CDN -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Google APIs -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    
    <!-- Stripe SDK for Premium -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Google One Tap Configuration -->
    <div id="g_id_onload"
         data-client_id="670002862076-ivoemo399amv728d61llbdqn3fbcr8tk.apps.googleusercontent.com"
         data-login_uri="https://dev-mjbs.github.io/MentalIA-3.1"
         data-auto_prompt="true">
    </div>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css?v=1143">
    <link rel="stylesheet" href="css/pdf-addon.css">
    <link rel="stylesheet" href="css/auth-styles.css">
    <link rel="stylesheet" href="css/status-indicator.css">
    <link rel="stylesheet" href="css/interactive-styles.css?v=1142">
    <link rel="stylesheet" href="css/premium-styles.css?v=1149">
    <link rel="stylesheet" href="css/mobile-touch.css">

    <!-- FIX TOQUE NO CELULAR + TOAST BONITO -->
    <style>
        *, *::before, *::after { -webkit-tap-highlight-color: transparent; }
        button, .nav-btn, .btn-primary, .btn-login, [data-screen],
        .primary-feeling-btn, .expand-icon, .sub-feeling-item,
        #backup-data, #generate-report, #generate-pdf-report, #theme-toggle, #login-toggle {
            cursor: pointer !important;
            pointer-events: auto !important;
            touch-action: manipulation !important;
            min-height: 44px;
            -webkit-user-select: none;
            user-select: none;
        }
        html, body { touch-action: pan-x pan-y pinch-zoom; }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Processando com IA...</h3>
            <p id="loading-message">Analisando seus dados com total privacidade...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p class="loading-note">üîî Te avisamos quando terminar!</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="logo">
                MentalIA 3.1
                <div class="status-indicator" id="status-indicator">
                    <div class="status-dot" id="status-dot"></div>
                    <span class="status-text" id="status-text">Offline</span>
                </div>
            </h1>
            
            <div class="header-actions">
                <div id="user-status" class="user-status hidden">
                    <div class="user-info">
                        <span id="user-email"></span>
                        <span id="user-plan" class="plan-badge">Gratuito</span>
                    </div>
                    <div class="user-actions">
                        <button id="logout-btn" class="btn-logout">Sair</button>
                    </div>
                </div>
                
                <button id="login-toggle" class="btn-login">Entrar</button>
                
                <button class="theme-toggle" id="theme-toggle" aria-label="Alternar tema">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-screen="welcome">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">In√≠cio</span>
        </button>
        <button class="nav-btn" data-screen="mood">
            <span class="nav-icon">üòä</span>
            <span class="nav-label">Humor</span>
        </button>
        <button class="nav-btn" data-screen="history">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Hist√≥rico</span>
        </button>
        <button class="nav-btn" data-screen="report">
            <span class="nav-icon">üîç</span>
            <span class="nav-label">Relat√≥rio</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Screen -->
        <section id="login-screen" class="screen">
            <div class="login-container">
                <div class="login-header">
                    <h2>üîë Entre no MentalIA</h2>
                    <p class="login-subtitle">Voc√™ cria uma conta s√≥ para desbloquear a vers√£o completa.<br>
                    <strong>Seus registros emocionais nunca saem do seu celular.</strong></p>
                </div>

                <div class="login-tabs">
                    <button class="tab-btn active" data-tab="login">Entrar</button>
                    <button class="tab-btn" data-tab="register">Criar Conta</button>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="auth-form active">
                    <div class="input-group">
                        <label for="login-email">üìß Email</label>
                        <input type="email" id="login-email" name="email" required placeholder="seu@email.com">
                    </div>
                    <div class="input-group">
                        <label for="login-password">üîí Senha</label>
                        <input type="password" id="login-password" name="password" required placeholder="Sua senha">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Entrar</button>
                    
                    <div class="auth-divider">
                        <span>ou</span>
                    </div>
                    
                    <div id="google-signin-btn" class="google-signin-btn">
                        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
                        <span>Entrar com Google</span>
                    </div>
                </form>

                <!-- Register Form -->
                <form id="register-form" class="auth-form">
                    <div class="input-group">
                        <label for="register-email">üìß Email</label>
                        <input type="email" id="register-email" name="email" required placeholder="seu@email.com">
                    </div>
                    <div class="input-group">
                        <label for="register-password">üîí Senha</label>
                        <input type="password" id="register-password" name="password" minlength="6" required placeholder="M√≠nimo 6 caracteres">
                    </div>
                    <div class="input-group">
                        <label for="register-confirm">üîí Confirmar Senha</label>
                        <input type="password" id="register-confirm" name="confirm" minlength="6" required placeholder="Confirme sua senha">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Criar Conta Gratuita</button>
                    
                    <div class="auth-divider">
                        <span>ou</span>
                    </div>
                    
                    <div id="google-signup-btn" class="google-signin-btn">
                        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
                        <span>Criar conta com Google</span>
                    </div>
                </form>

                <div class="auth-footer">
                    <p class="privacy-note">üîí <strong>Privacidade total:</strong> Apenas email + senha ficam no servidor. Todos os seus registros emocionais permanecem 100% locais no seu dispositivo.</p>
                </div>
            </div>
        </section>
        
        <!-- Welcome Screen -->
        <section id="welcome-screen" class="screen active">
            <div class="welcome-hero">
                <div class="hero-icon">üß†‚ú®</div>
                <h2>Bem-vindo ao MentalIA 3.0</h2>
                <p class="hero-subtitle">Sua sa√∫de mental protegida com IA m√©dica local</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üîí</div>
                        <h3>100% Privado</h3>
                        <p>Seus dados nunca saem do seu dispositivo</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üß†</div>
                        <h3>IA M√©dica Local</h3>
                        <p>MedGemma-4B processando localmente</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìä</div>
                        <h3>An√°lise Profunda</h3>
                        <p>Relat√≥rios detalhados do seu bem-estar</p>
                    </div>
                </div>

                <div class="cta-buttons">
                    <button class="btn-primary" data-screen="mood">
                        Registrar Humor Agora
                    </button>
                    <button class="btn-secondary" data-screen="history">
                        Ver Hist√≥rico
                    </button>
                    <!-- DEBUG: Bot√£o de teste para toast -->
                    <button class="btn-secondary" onclick="window.mentalIA?.showToast('Teste de toast funcionando!', 'success', 3000)">
                        üß™ Testar Toast
                    </button>
                </div>
            </div>

            <!-- Emergency Contact -->
            <div class="emergency-card">
                <div class="emergency-icon">üÜò</div>
                <h3>Precisa de ajuda imediata?</h3>
                <p>Centro de Valoriza√ß√£o da Vida - CVV</p>
                <a href="tel:188" class="emergency-btn">üìû Ligar 188</a>
                <p class="emergency-note">Dispon√≠vel 24h, gratuito e sigiloso</p>
            </div>
        </section>

        <!-- Mood Registration Screen -->
        <section id="mood-screen" class="screen">
            <div class="mood-header">
                <h2 class="mood-title">Como voc√™ est√° se sentindo hoje?</h2>
                <p class="mood-subtitle">Registre seu humor e pensamentos de forma segura</p>
                
                <div class="security-badge">
                    <span class="security-icon">üîí</span>
                    <span class="security-text">Dados criptografados localmente ‚Ä¢ Nunca saem do seu celular</span>
                </div>
            </div>

            <form id="mood-form" class="mood-form">
                <!-- Mood Slider Section -->
                <div class="mood-slider-section">
                    <div class="slider-container">
                        <!-- BIG emoji shown prominently -->
                        <div class="big-mood-wrapper">
                            <div id="big-mood-emoji" class="big-mood-emoji" aria-hidden="true">üòê</div>
                        </div>

                        <!-- Slider: 1.0 - 10.0 per spec -->
                        <input type="range" id="mood-slider" min="1" max="10" value="5" class="mood-slider" step="0.1"
                               aria-label="N√≠vel de humor de 1 a 10" title="Deslize para ajustar seu humor">
                    </div>

                    <div class="mood-indicators">
                        <div class="mood-indicator" data-value="1">
                            <div class="indicator-emoji">üò¢</div>
                            <div class="indicator-label">Muito Baixo</div>
                        </div>
                        <div class="mood-indicator" data-value="4">
                            <div class="indicator-emoji">üòê</div>
                            <div class="indicator-label">Neutro</div>
                        </div>
                        <div class="mood-indicator" data-value="7">
                            <div class="indicator-emoji">üòä</div>
                            <div class="indicator-label">Alto</div>
                        </div>
                        <div class="mood-indicator" data-value="10">
                            <div class="indicator-emoji">ü•∞</div>
                            <div class="indicator-label">Muito Alto</div>
                        </div>
                    </div>

                    <div class="current-mood">
                        <div class="current-mood-text" id="current-mood-text">Neutro</div>
                        <div class="current-mood-value" id="current-mood-value">5.0</div>
                    </div>
                </div>

                <!-- Feelings Wheel Section -->
                <div class="feelings-section">
                    <h3 class="section-title">Como voc√™ se sente hoje?</h3>
                    <p class="feelings-subtitle">Selecione os sentimentos principais e depois os espec√≠ficos</p>
                    
                    <!-- Primary Feelings Grid -->
                    <div class="primary-feelings-grid">
                        <div class="primary-feeling-card" data-category="alegria">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üòä</span>
                                <span class="primary-label">Alegria</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="feliz" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòÑ</span>
                                            <span class="sub-label">Feliz</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="animado" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">ü§©</span>
                                            <span class="sub-label">Animado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="grato" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üôè</span>
                                            <span class="sub-label">Grato</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="orgulhoso" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòå</span>
                                            <span class="sub-label">Orgulhoso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="esperancoso" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">‚ú®</span>
                                            <span class="sub-label">Esperan√ßoso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="euf√≥rico" data-category="alegria">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üéâ</span>
                                            <span class="sub-label">Euf√≥rico</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="tristeza">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üò¢</span>
                                <span class="primary-label">Tristeza</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="triste" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòî</span>
                                            <span class="sub-label">Triste</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="melanc√≥lico" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòû</span>
                                            <span class="sub-label">Melanc√≥lico</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="sozinho" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòë</span>
                                            <span class="sub-label">Sozinho</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="desesperado" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò∞</span>
                                            <span class="sub-label">Desesperado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="vazio" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò∂</span>
                                            <span class="sub-label">Vazio</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="desanimado" data-category="tristeza">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòì</span>
                                            <span class="sub-label">Desanimado</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="raiva">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üò†</span>
                                <span class="primary-label">Raiva</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="irritado" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò§</span>
                                            <span class="sub-label">Irritado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="furioso" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">ü§¨</span>
                                            <span class="sub-label">Furioso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="frustrado" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòñ</span>
                                            <span class="sub-label">Frustrado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="revoltado" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò°</span>
                                            <span class="sub-label">Revoltado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="indignado" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòæ</span>
                                            <span class="sub-label">Indignado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="impaciente" data-category="raiva">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòí</span>
                                            <span class="sub-label">Impaciente</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="medo">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üò®</span>
                                <span class="primary-label">Medo</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="ansioso" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò∞</span>
                                            <span class="sub-label">Ansioso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="assustado" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò±</span>
                                            <span class="sub-label">Assustado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="inseguro" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòü</span>
                                            <span class="sub-label">Inseguro</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="preocupado" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòß</span>
                                            <span class="sub-label">Preocupado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="nervoso" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò¨</span>
                                            <span class="sub-label">Nervoso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="tenso" data-category="medo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò£</span>
                                            <span class="sub-label">Tenso</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="nojo">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">ü§¢</span>
                                <span class="primary-label">Nojo</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="enojado" data-category="nojo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">ü§Æ</span>
                                            <span class="sub-label">Enojado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="repugnado" data-category="nojo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòù</span>
                                            <span class="sub-label">Repugnado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="avers√£o" data-category="nojo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">ü§ß</span>
                                            <span class="sub-label">Avers√£o</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="desconforto" data-category="nojo">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòµ</span>
                                            <span class="sub-label">Desconforto</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="surpresa">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üò≤</span>
                                <span class="primary-label">Surpresa</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="chocado" data-category="surpresa">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò≥</span>
                                            <span class="sub-label">Chocado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="espantado" data-category="surpresa">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòØ</span>
                                            <span class="sub-label">Espantado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="admirado" data-category="surpresa">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">ü§Ø</span>
                                            <span class="sub-label">Admirado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="impressionado" data-category="surpresa">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòÆ</span>
                                            <span class="sub-label">Impressionado</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="primary-feeling-card" data-category="neutro">
                            <div class="primary-feeling-btn">
                                <span class="primary-emoji">üòê</span>
                                <span class="primary-label">Neutro</span>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="sub-feelings-panel">
                                <div class="sub-feelings-grid">
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="confuso" data-category="neutro">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòµ‚Äçüí´</span>
                                            <span class="sub-label">Confuso</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="entediado" data-category="neutro">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòë</span>
                                            <span class="sub-label">Entediado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="cansado" data-category="neutro">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò¥</span>
                                            <span class="sub-label">Cansado</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="ap√°tico" data-category="neutro">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üò∂‚Äçüå´Ô∏è</span>
                                            <span class="sub-label">Ap√°tico</span>
                                        </span>
                                    </label>
                                    <label class="sub-feeling-item">
                                        <input type="checkbox" value="calmo" data-category="neutro">
                                        <span class="sub-feeling-content">
                                            <span class="sub-emoji">üòå</span>
                                            <span class="sub-label">Calmo</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selected Feelings Summary -->
                    <div class="selected-feelings-summary">
                        <h4>Sentimentos selecionados:</h4>
                        <div class="selected-feelings-list" id="selected-feelings-list"></div>
                        <button type="button" class="clear-selection-btn" id="clear-feelings">Limpar sele√ß√£o</button>
                    </div>
                </div>

                <!-- Diary Entry -->
                <div class="diary-section">
                    <h3 class="section-title">Di√°rio Pessoal <span class="optional-tag">(Opcional)</span></h3>
                    <textarea 
                        id="diary-entry" 
                        placeholder="Escreva sobre seu dia, pensamentos ou qualquer coisa que queira registrar..."
                        rows="4"
                        class="diary-textarea"
                    ></textarea>
                    <div class="textarea-info">
                        <span class="privacy-note">üîí Criptografado localmente</span>
                        <span class="char-count" id="char-count">0 caracteres</span>
                    </div>
                </div>

                <!-- Continue Button -->
                <button type="submit" class="mood-continue-btn">
                    <span class="btn-text">Continuar</span>
                    <span class="btn-icon">‚Üí</span>
                </button>
            </form>
        </section>

        <!-- History Screen -->
        <section id="history-screen" class="screen">
            <div class="screen-header">
                <h2>Seu Hist√≥rico de Humor</h2>
                <p>Visualize sua jornada de bem-estar</p>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="mood-chart"></canvas>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-content">
                        <h3 id="avg-mood">0</h3>
                        <p>Humor M√©dio</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <h3 id="total-entries">0</h3>
                        <p>Registros</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-content">
                        <h3 id="streak-days">0</h3>
                        <p>Dias Seguidos</p>
                    </div>
                </div>
            </div>

            <!-- Recent Entries -->
            <div class="recent-entries">
                <h3>Registros Recentes</h3>
                <div id="recent-list" class="entries-list">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Data Management -->
            <div class="data-management">
                <h3>Gerenciamento de Dados</h3>
                <p class="privacy-note">üõ°Ô∏è Respeitamos sua privacidade (LGPD Art. 18)</p>
                <button id="delete-all-data" class="btn-secondary delete-all-btn">
                    <span class="btn-icon">üóëÔ∏è</span>
                    <span class="btn-text">Apagar todos os meus dados</span>
                </button>
            </div>
        </section>

        <!-- Report Screen -->
        <section id="report-screen" class="screen report-screen-fade-in">
            <div class="report-hero">
                <div class="report-hero-icon">üìä</div>
                <h1 class="report-hero-title">Relat√≥rio de Bem-Estar</h1>
                <p class="report-hero-subtitle">An√°lise personalizada do seu humor e emo√ß√µes</p>
            </div>

            <div class="report-controls">
                <button id="generate-report" class="btn-primary btn-large">üß† Gerar Relat√≥rio</button>
            </div>

            <div id="report-content" class="report-content hidden">
                <div class="report-sections">
                    <div class="report-section-card">
                        <div class="section-header">
                            <span class="section-icon">üéØ</span>
                            <h3>Avalia√ß√£o Geral</h3>
                        </div>
                        <div id="general-analysis" class="section-content">Carregando an√°lise...</div>
                    </div>

                    <div class="report-section-card">
                        <div class="section-header">
                            <span class="section-icon">üìà</span>
                            <h3>Gr√°fico de Humor</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="report-chart"></canvas>
                        </div>
                    </div>

                    <div class="report-section-card">
                        <div class="section-header">
                            <span class="section-icon">üîç</span>
                            <h3>Padr√µes Identificados</h3>
                        </div>
                        <div id="patterns-analysis" class="section-content">‚Äî</div>
                    </div>

                    <div class="report-section-card">
                        <div class="section-header">
                            <span class="section-icon">‚ö°</span>
                            <h3>Gatilhos</h3>
                        </div>
                        <div id="triggers-analysis" class="section-content">‚Äî</div>
                    </div>

                    <div class="report-section-card">
                        <div class="section-header">
                            <span class="section-icon">üí°</span>
                            <h3>Recomenda√ß√µes</h3>
                        </div>
                        <div id="recommendations" class="section-content">‚Äî</div>
                    </div>
                </div>

                <div class="report-disclaimer">
                    <p><strong>‚ö†Ô∏è Importante:</strong> Este relat√≥rio √© uma ferramenta de apoio e n√£o substitui avalia√ß√£o profissional. Em caso de crise, ligue 188 (CVV) ou procure um psic√≥logo/psiquiatra.</p>
                </div>
            </div>

            <div id="report-placeholder" class="report-placeholder">
                <div class="placeholder-icon">üìã</div>
                <h3>Nenhum relat√≥rio gerado ainda</h3>
                <p>Registre seu humor diariamente para receber an√°lises personalizadas e insights sobre seu bem-estar.</p>
                <button class="btn-primary" data-screen="mood">Registrar Primeiro Humor</button>
            </div>

            <!-- Sticky Bottom Bar -->
            <div class="sticky-bar">
                <button id="export-therapist-pdf" class="btn-secondary">üìÑ Exportar PDF</button>
                <button id="share-report" class="btn-share">üì§ Compartilhar</button>
            </div>
        </section>
    </main>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Confirmar Exclus√£o</h3>
            </div>
            <div class="modal-body">
                <p id="modal-message">Tem certeza que quer excluir este registro? Isso √© permanente.</p>
            </div>
            <div class="modal-actions">
                <button id="confirm-delete" class="btn-primary">Sim, excluir</button>
                <button id="cancel-delete" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- SCRIPTS NA ORDEM CERTA (ESSA √â A CHAVE) -->
    <script src="js/debug.js?v=1141"></script>
    <script src="js/storage.js?v=1141"></script>                 <!-- 1¬∫ -->
    <script src="js/auth.js?v=1141"></script>
    <script src="js/mock-api.js?v=1150"></script>                <!-- Mock API para desenvolvimento -->
    <script src="js/ai_analysis.js?v=1148"></script>             <!-- 2¬∫ -->
    <script src="js/google_drive_backup.js?v=1141"></script>     <!-- 3¬∫ -->
    <script src="js/app.js?v=1149"></script>                     <!-- 4¬∫ e √∫ltimo -->
    <script src="js/auto_test_runner.js?v=1"></script>

    <!-- Service Worker + Inicializa√ß√£o Segura -->
    <script>
        console.log('üöÄ HTML carregado, iniciando setup...');

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registrado:', reg.scope))
                    .catch(err => console.error('SW falhou:', err));
            });
        }

        // ESPERA TUDO CARREGAR ANTES DE INICIAR O APP
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üìÑ DOMContentLoaded disparado - Timestamp:', Date.now());
            console.log('üìÑ Estado do DOM:', document.readyState);
            
            const wait = () => new Promise(r => {
                const check = () => {
                    console.log('üîÑ Verificando depend√™ncias:', {
                        mentalStorage: !!window.mentalStorage,
                        aiAnalysis: !!window.aiAnalysis,
                        googleDriveBackup: !!window.googleDriveBackup
                    });
                    
                    if (window.mentalStorage && window.aiAnalysis && window.googleDriveBackup) {
                        console.log('‚úÖ Todas as depend√™ncias carregadas!');
                        r();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
            
            console.log('‚è≥ Aguardando depend√™ncias carregarem...');
            await wait();
            
            console.log('üéØ Inicializando MentalIA...');
            window.mentalIA = new MentalIA();
            await window.mentalIA.init();
            
            // Make showScreen globally available for HTML onclick handlers
            window.showScreen = (screenName) => window.mentalIA.showScreen(screenName);
            
            console.log('üéâ MentalIA totalmente inicializado!');
        });
    </script>
</body>
</html>