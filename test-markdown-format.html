<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste - Formata√ß√£o de Relat√≥rio</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover { background: #0056b3; }
        
        /* Import variables from main CSS */
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f172a;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .container {
            background: var(--bg-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Formata√ß√£o de Relat√≥rio</h1>
        <p><strong>Objetivo:</strong> Verificar se o markdown est√° sendo convertido corretamente para HTML</p>
        
        <button class="test-button" onclick="testMarkdownFormatting()">üîÑ Testar Formata√ß√£o Markdown</button>
        <button class="test-button" onclick="testWithRealData()">üìä Testar com Dados Reais</button>
        <button class="test-button" onclick="clearReport()">üóëÔ∏è Limpar Relat√≥rio</button>
        
        <div id="report-content" class="hidden"></div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/ai_analysis.js"></script>
    <script>
        // Simulate the markdownToHtml function from app.js
        function markdownToHtml(markdown) {
            if (!markdown) return '';
            
            let html = markdown
                // Headers
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                
                // Bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/__(.*?)__/g, '<strong>$1</strong>')
                
                // Italic text
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/_(.*?)_/g, '<em>$1</em>')
                
                // Lists
                .replace(/^\‚Ä¢ (.*$)/gim, '<li>$1</li>')
                .replace(/^- (.*$)/gim, '<li>$1</li>')
                .replace(/^\* (.*$)/gim, '<li>$1</li>')
                
                // Line breaks
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
                
            // Wrap lists in ul tags
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Wrap paragraphs
            if (!html.includes('<p>') && !html.includes('<h')) {
                html = `<p>${html}</p>`;
            }
            
            return html;
        }

        function displayReport(report) {
            const content = document.getElementById('report-content');
            if (content) {
                content.classList.remove('hidden');

                // Handle different report formats
                let htmlContent = '';
                if (typeof report === 'string') {
                    // Convert markdown string to HTML
                    const convertedContent = markdownToHtml(report);
                    htmlContent = `<div class="report-section"><div class="analysis-content">${convertedContent}</div></div>`;
                } else if (report.analysis) {
                    // Convert markdown analysis to HTML
                    const convertedAnalysis = markdownToHtml(report.analysis);
                    
                    htmlContent = `
                        <div class="report-section">
                            <div class="report-header">
                                <h2 class="report-title">${report.title || 'An√°lise de Humor'}</h2>
                                ${report.subtitle ? `<p class="report-subtitle">${report.subtitle}</p>` : ''}
                            </div>
                            <div class="analysis-content">${convertedAnalysis}</div>
                            ${report.recommendations && report.recommendations.length > 0 ? `
                                <div class="recommendations">
                                    <h3>üí° Recomenda√ß√µes Personalizadas</h3>
                                    <ul class="recommendation-list">
                                        ${report.recommendations.map(r => `<li>${markdownToHtml(r)}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${report.insights && report.insights.length > 0 ? `
                                <div class="insights">
                                    <h3>üåü Insights Importantes</h3>
                                    <ul class="insight-list">
                                        ${report.insights.map(i => `<li>${markdownToHtml(i)}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${report.disclaimer ? `
                                <div class="disclaimer">
                                    <h4>‚ö†Ô∏è Importante</h4>
                                    <p>${markdownToHtml(report.disclaimer)}</p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    htmlContent = `<div class="report-section"><div class="analysis-content">${JSON.stringify(report, null, 2)}</div></div>`;
                }

                content.innerHTML = htmlContent;
                console.log('üìä Relat√≥rio exibido e formatado:', report);
            } else {
                console.error('‚ùå Elemento report-content n√£o encontrado');
            }
        }

        function testMarkdownFormatting() {
            console.log('üß™ Testando formata√ß√£o markdown...');
            
            const testReport = {
                title: 'Relat√≥rio de Bem-Estar MentalIA',
                subtitle: 'An√°lise Inteligente Baseada em Seus Dados',
                analysis: `## An√°lise Personalizada do Seu Bem-Estar Emocional

Ol√°! Baseado em **3 registros** de humor coletados ao longo de **2 dias**, preparei uma an√°lise cuidadosa do seu padr√£o emocional:

### üéØ **Avalia√ß√£o Geral do Seu Estado Emocional**

Seus registros mostram um padr√£o **excepcional** de bem-estar emocional, com uma m√©dia de **4.2/5.0**. Isso indica que voc√™ est√° passando por um per√≠odo muito positivo, mantendo altos n√≠veis de satisfa√ß√£o e contentamento na maior parte do tempo.

### üé≠ **Padr√µes Emocionais Identificados**

Os sentimentos mais presentes em seus registros s√£o: **Feliz, Animado, Esperan√ßoso**. Isso nos d√° pistas importantes sobre seus estados emocionais mais recorrentes.

### üìà **Tend√™ncia Positiva**

Seus dados mostram uma tend√™ncia de *melhora* no humor nos √∫ltimos dias, o que √© um sinal muito encorajador. Continue com as pr√°ticas que est√£o funcionando!`,
                
                recommendations: [
                    'Mantenha o h√°bito de **registrar seu humor diariamente** - o autocuidado come√ßa com a consci√™ncia',
                    'Pratique **atividades f√≠sicas regulares**, que ajudam no equil√≠brio emocional',
                    'Continue com as pr√°ticas que est√£o funcionando bem - voc√™ merece *comemorar* suas vit√≥rias'
                ],
                
                insights: [
                    'Padr√£o de **bem-estar consistente** identificado',
                    'Tend√™ncia de *melhora* no humor recente',
                    'Estados emocionais predominantemente **positivos**'
                ],
                
                disclaimer: 'Esta an√°lise √© baseada em **intelig√™ncia artificial local**. N√£o substitui consulta m√©dica ou psicol√≥gica profissional.',
                
                timestamp: new Date().toISOString(),
                source: 'MentalIA Analysis Engine'
            };

            displayReport(testReport);
        }

        async function testWithRealData() {
            console.log('üß™ Testando com dados reais...');
            
            try {
                if (window.aiAnalysis) {
                    // Try to get real data
                    const entries = JSON.parse(localStorage.getItem('mentalEntries') || '[]');
                    if (entries.length > 0) {
                        const report = await window.aiAnalysis.generateReport(entries);
                        displayReport(report);
                    } else {
                        alert('Nenhum dado encontrado. Adicione alguns registros de humor primeiro.');
                    }
                } else {
                    alert('AI Analysis n√£o carregado. Usando dados de exemplo.');
                    testMarkdownFormatting();
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao gerar relat√≥rio: ' + error.message);
            }
        }

        function clearReport() {
            const content = document.getElementById('report-content');
            if (content) {
                content.classList.add('hidden');
                content.innerHTML = '';
            }
        }

        // Initialize
        window.onload = function() {
            console.log('üß™ P√°gina de teste carregada');
            console.log('AI Analysis dispon√≠vel:', !!window.aiAnalysis);
        };
    </script>
</body>
</html>