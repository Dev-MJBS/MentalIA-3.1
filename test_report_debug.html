<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste RelatÃ³rio MentalIA</title>
</head>
<body>
    <h1>Teste de GeraÃ§Ã£o de RelatÃ³rio</h1>
    <button onclick="testReportGeneration()">Gerar RelatÃ³rio de Teste</button>
    <div id="output"></div>

    <script src="js/storage.js"></script>
    <script src="js/ai_analysis.js"></script>

    <script>
        async function testReportGeneration() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>ğŸ”„ Testando geraÃ§Ã£o de relatÃ³rio...</p>';

            try {
                // Adicionar dados de teste primeiro
                console.log('ğŸ“ Adicionando dados de teste...');
                const testEntries = [
                    { mood: 3.5, feelings: [{ value: "calmo", label: "Calmo", emoji: "" }], diary: "Dia tranquilo", timestamp: new Date(Date.now() - 86400000 * 6).toISOString() },
                    { mood: 4.2, feelings: [{ value: "feliz", label: "Feliz", emoji: "" }], diary: "Dia bom", timestamp: new Date(Date.now() - 86400000 * 5).toISOString() },
                    { mood: 2.8, feelings: [{ value: "ansioso", label: "Ansioso", emoji: "" }], diary: "Dia estressante", timestamp: new Date(Date.now() - 86400000 * 4).toISOString() }
                ];

                for (const entry of testEntries) {
                    await window.mentalStorage.saveMoodEntry(entry);
                    console.log('âœ… Registro adicionado:', entry.mood);
                }

                output.innerHTML += '<p>âœ… Dados de teste adicionados</p>';

                // Agora testar geraÃ§Ã£o do relatÃ³rio
                console.log('ğŸ§  Testando geraÃ§Ã£o de relatÃ³rio...');
                const entries = await window.mentalStorage.getAllEntries();
                console.log('ğŸ“Š Entradas encontradas:', entries.length, entries);

                if (entries.length === 0) {
                    output.innerHTML += '<p>âŒ Nenhuma entrada encontrada!</p>';
                    return;
                }

                const report = await window.aiAnalysis.generateReport(entries);
                console.log('ğŸ“„ RelatÃ³rio gerado:', report);

                if (report && report.title) {
                    output.innerHTML += '<p>âœ… RelatÃ³rio gerado com sucesso!</p>';
                    output.innerHTML += '<h3>' + report.title + '</h3>';
                    output.innerHTML += '<p>' + (report.analysis ? report.analysis.substring(0, 200) + '...' : 'Sem anÃ¡lise') + '</p>';
                } else {
                    output.innerHTML += '<p>âŒ RelatÃ³rio vazio ou invÃ¡lido!</p>';
                    console.error('RelatÃ³rio invÃ¡lido:', report);
                }

            } catch (error) {
                output.innerHTML += '<p>âŒ Erro durante o teste: ' + error.message + '</p>';
                console.error('Erro no teste:', error);
            }
        }

        // Inicializar quando a pÃ¡gina carregar
        window.addEventListener('load', () => {
            console.log('ğŸš€ PÃ¡gina de teste carregada');
        });
    </script>
</body>
</html>