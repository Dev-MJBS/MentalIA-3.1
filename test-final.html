<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Teste Final - GeraÃ§Ã£o de RelatÃ³rio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Teste Final - GeraÃ§Ã£o de RelatÃ³rio</h1>
        <p><strong>Objetivo:</strong> Verificar se todas as correÃ§Ãµes estÃ£o funcionando</p>
        
        <div class="section">
            <h2>ğŸ“Š Status dos Testes</h2>
            <div id="test-results"></div>
        </div>

        <div class="section">
            <h2>ğŸ¯ Testes DisponÃ­veis</h2>
            <button onclick="testFunction1()">Teste 1: Verificar FunÃ§Ã£o generateReport()</button>
            <button onclick="testFunction2()">Teste 2: Dados VÃ¡lidos</button>
            <button onclick="testFunction3()">Teste 3: Dados InvÃ¡lidos</button>
            <button onclick="testFunction4()">Teste 4: Sem Dados</button>
            <button onclick="testFunction5()">Teste 5: Fallbacks</button>
            <button onclick="runAllTests()">ğŸš€ Executar Todos os Testes</button>
        </div>

        <div class="section">
            <h2>ğŸ“ Console Log</h2>
            <pre id="console-log"></pre>
        </div>

        <div class="section">
            <h2>ğŸ“‹ Dados de Teste</h2>
            <button onclick="createTestData()">ğŸ“Š Criar Dados de Teste</button>
            <button onclick="clearTestData()">ğŸ—‘ï¸ Limpar Dados</button>
            <div id="data-info"></div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/ai_analysis.js"></script>
    <script>
        let testResults = [];
        let consoleOutput = [];

        // Override console.log para capturar saÃ­das
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.push(`[LOG] ${args.join(' ')}`);
            updateConsoleDisplay();
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            consoleOutput.push(`[ERROR] ${args.join(' ')}`);
            updateConsoleDisplay();
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            consoleOutput.push(`[WARN] ${args.join(' ')}`);
            updateConsoleDisplay();
        };

        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-log');
            consoleDiv.textContent = consoleOutput.slice(-20).join('\n');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function addTestResult(name, success, message) {
            testResults.push({ name, success, message, timestamp: new Date().toLocaleTimeString() });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.success ? 'success' : 'error'}">
                    [${result.timestamp}] ${result.name}: ${result.message}
                </div>`
            ).join('');
        }

        async function testFunction1() {
            console.log('ğŸ§ª Iniciando Teste 1: Verificar funÃ§Ã£o generateReport()');
            
            try {
                // Verificar se a funÃ§Ã£o existe
                if (!window.aiAnalysis || typeof window.aiAnalysis.generateReport !== 'function') {
                    addTestResult('Teste 1', false, 'FunÃ§Ã£o generateReport() nÃ£o encontrada');
                    return;
                }

                addTestResult('Teste 1', true, 'FunÃ§Ã£o generateReport() existe e Ã© acessÃ­vel');
                console.log('âœ… FunÃ§Ã£o generateReport() OK');
                
            } catch (error) {
                addTestResult('Teste 1', false, `Erro: ${error.message}`);
                console.error('âŒ Erro no Teste 1:', error);
            }
        }

        async function testFunction2() {
            console.log('ğŸ§ª Iniciando Teste 2: Dados vÃ¡lidos');
            
            try {
                const testEntries = [
                    { mood: 8, date: '2024-01-01', notes: 'Bom dia' },
                    { mood: 6, date: '2024-01-02', notes: 'Dia normal' },
                    { mood: 9, date: '2024-01-03', notes: 'Excelente!' }
                ];

                console.log('ğŸ“Š Testando com dados vÃ¡lidos:', testEntries.length, 'entradas');
                const report = await window.aiAnalysis.generateReport(testEntries);
                
                if (report && report.title) {
                    addTestResult('Teste 2', true, `RelatÃ³rio gerado: "${report.title}"`);
                    console.log('âœ… RelatÃ³rio gerado com sucesso');
                } else {
                    addTestResult('Teste 2', false, 'RelatÃ³rio invÃ¡lido retornado');
                }
                
            } catch (error) {
                addTestResult('Teste 2', false, `Erro: ${error.message}`);
                console.error('âŒ Erro no Teste 2:', error);
            }
        }

        async function testFunction3() {
            console.log('ğŸ§ª Iniciando Teste 3: Dados invÃ¡lidos');
            
            try {
                const invalidEntries = [
                    { mood: 'invalid', date: '2024-01-01' },
                    { mood: NaN, date: '2024-01-02' },
                    { mood: null, date: '2024-01-03' },
                    null,
                    undefined
                ];

                console.log('âš ï¸ Testando com dados invÃ¡lidos');
                const report = await window.aiAnalysis.generateReport(invalidEntries);
                
                if (report && report.title) {
                    addTestResult('Teste 3', true, 'Sistema tratou dados invÃ¡lidos corretamente');
                    console.log('âœ… Fallback funcionou corretamente');
                } else {
                    addTestResult('Teste 3', false, 'Sistema nÃ£o tratou dados invÃ¡lidos');
                }
                
            } catch (error) {
                addTestResult('Teste 3', false, `Erro: ${error.message}`);
                console.error('âŒ Erro no Teste 3:', error);
            }
        }

        async function testFunction4() {
            console.log('ğŸ§ª Iniciando Teste 4: Sem dados');
            
            try {
                console.log('ğŸ“­ Testando sem dados');
                const report = await window.aiAnalysis.generateReport([]);
                
                if (report && report.title) {
                    addTestResult('Teste 4', true, 'Sistema lidou com dados vazios corretamente');
                    console.log('âœ… Fallback para dados vazios OK');
                } else {
                    addTestResult('Teste 4', false, 'Sistema falhou com dados vazios');
                }
                
            } catch (error) {
                addTestResult('Teste 4', false, `Erro: ${error.message}`);
                console.error('âŒ Erro no Teste 4:', error);
            }
        }

        async function testFunction5() {
            console.log('ğŸ§ª Iniciando Teste 5: Teste de fallbacks');
            
            try {
                // Testar com null
                let report = await window.aiAnalysis.generateReport(null);
                if (!report || !report.title) {
                    addTestResult('Teste 5', false, 'Fallback para null falhou');
                    return;
                }

                // Testar com undefined
                report = await window.aiAnalysis.generateReport(undefined);
                if (!report || !report.title) {
                    addTestResult('Teste 5', false, 'Fallback para undefined falhou');
                    return;
                }

                addTestResult('Teste 5', true, 'Todos os fallbacks funcionaram');
                console.log('âœ… Sistema de fallbacks robusto');
                
            } catch (error) {
                addTestResult('Teste 5', false, `Erro: ${error.message}`);
                console.error('âŒ Erro no Teste 5:', error);
            }
        }

        async function runAllTests() {
            console.log('ğŸš€ Executando todos os testes...');
            testResults = [];
            consoleOutput = [];
            
            await testFunction1();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFunction2();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFunction3();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFunction4();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFunction5();
            
            console.log('ğŸ‰ Todos os testes concluÃ­dos!');
            
            const successCount = testResults.filter(r => r.success).length;
            const totalTests = testResults.length;
            
            if (successCount === totalTests) {
                addTestResult('RESULTADO FINAL', true, `Todos os ${totalTests} testes passaram! Sistema funcionando perfeitamente.`);
            } else {
                addTestResult('RESULTADO FINAL', false, `${successCount}/${totalTests} testes passaram. Verificar erros acima.`);
            }
        }

        function createTestData() {
            const testData = [
                { mood: 8, date: new Date().toISOString().split('T')[0], notes: 'Teste de humor bom', time: '10:00' },
                { mood: 5, date: new Date(Date.now() - 86400000).toISOString().split('T')[0], notes: 'Teste neutro', time: '14:30' },
                { mood: 7, date: new Date(Date.now() - 172800000).toISOString().split('T')[0], notes: 'Teste positivo', time: '18:45' }
            ];
            
            localStorage.setItem('mentalEntries', JSON.stringify(testData));
            document.getElementById('data-info').innerHTML = 
                `<div class="test-result success">âœ… ${testData.length} entradas de teste criadas no localStorage</div>`;
            console.log('ğŸ“Š Dados de teste criados:', testData);
        }

        function clearTestData() {
            localStorage.removeItem('mentalEntries');
            document.getElementById('data-info').innerHTML = 
                `<div class="test-result warning">ğŸ—‘ï¸ Dados de teste removidos</div>`;
            console.log('ğŸ—‘ï¸ Dados limpos');
        }

        // InicializaÃ§Ã£o
        window.onload = function() {
            console.log('ğŸ§ª PÃ¡gina de teste carregada');
            addTestResult('Sistema', true, 'PÃ¡gina de teste iniciada');
            
            // Verificar se o AI Analysis estÃ¡ carregado
            if (window.aiAnalysis) {
                addTestResult('Carregamento', true, 'AI Analysis carregado com sucesso');
            } else {
                addTestResult('Carregamento', false, 'AI Analysis nÃ£o foi carregado');
            }
        };
    </script>
</body>
</html>