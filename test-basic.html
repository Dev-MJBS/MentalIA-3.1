<!DOCTYPE html>
<html>
<head>
    <title>Teste B√°sico MentalIA Storage</title>
</head>
<body>
    <h1>Teste B√°sico de Storage</h1>
    <div id="results"></div>

    <script src="js/storage.js"></script>
    <script>
        async function runTest() {
            const results = document.getElementById('results');
            results.innerHTML = 'Testando...<br>';

            try {
                // Test 1: Check if storage exists
                if (!window.mentalStorage) {
                    results.innerHTML += '‚ùå MentalStorage n√£o encontrado<br>';
                    return;
                }
                results.innerHTML += '‚úÖ MentalStorage encontrado<br>';

                // Test 2: Initialize
                results.innerHTML += 'Inicializando...<br>';
                await window.mentalStorage.init();
                results.innerHTML += '‚úÖ Inicializa√ß√£o bem-sucedida<br>';

                // Test 3: Save test entry
                results.innerHTML += 'Salvando entrada de teste...<br>';
                const testEntry = {
                    mood: 4.0,
                    feelings: ['feliz'],
                    diary: 'Teste de persist√™ncia',
                    timestamp: new Date().toISOString()
                };
                const saved = await window.mentalStorage.saveMoodEntry(testEntry);
                results.innerHTML += `‚úÖ Entrada salva com ID: ${saved.id}<br>`;

                // Test 4: Load entries
                results.innerHTML += 'Carregando entradas...<br>';
                const entries = await window.mentalStorage.getAllMoodEntries();
                results.innerHTML += `‚úÖ ${entries.length} entradas carregadas<br>`;

                // Test 5: Check persistence (reload page)
                results.innerHTML += '<br><strong>üîÑ RECARREGUE A P√ÅGINA AGORA PARA TESTAR PERSIST√äNCIA</strong><br>';
                results.innerHTML += 'Ap√≥s recarregar, deve aparecer "Dados persistem ap√≥s reload"<br>';

                // Store test flag
                localStorage.setItem('test-reload', 'true');

            } catch (error) {
                results.innerHTML += `‚ùå Erro: ${error.message}<br>`;
                console.error(error);
            }
        }

        // Check if this is a reload
        window.addEventListener('load', async () => {
            const results = document.getElementById('results');

            if (localStorage.getItem('test-reload')) {
                localStorage.removeItem('test-reload');
                results.innerHTML = '<strong>‚úÖ Dados persistem ap√≥s reload!</strong><br>Testando carregamento...<br>';

                try {
                    await window.mentalStorage.init();
                    const entries = await window.mentalStorage.getAllMoodEntries();
                    results.innerHTML += `‚úÖ ${entries.length} entradas encontradas ap√≥s reload<br>`;
                    results.innerHTML += '<strong>SUCESSO: Persist√™ncia funcionando!</strong>';
                } catch (error) {
                    results.innerHTML += `‚ùå Erro ap√≥s reload: ${error.message}`;
                }
            } else {
                runTest();
            }
        });
    </script>
</body>
</html>